{% extends 'admin/layout.html' %}
{% import 'admin/_macros.html' as lib with context %}
{% set name = admin_view.get_display_name() %}

{% block styles %}
<link href="{{ url_for('admin.static', filename='chosen/chosen.css') }}" rel="stylesheet">
<link href="{{ url_for('admin.static', filename='css/datepicker.css') }}" rel="stylesheet">
{{super()}}
{% endblock %}

{% block scripts %}
{{super()}}
<script src="{{ url_for('admin.static', filename='js/bootstrap-datepicker.js') }}"></script>
<script src="{{ url_for('admin.static', filename='js/form.js') }}"></script>
<script src="{{ url_for('admin.static', filename='js/filters.js') }}"></script>
{% endblock %}

{% block contentbody %}
<table class="table table-striped table-condensed table-hover">
	<thead>
		<tr>
			<th class="model-check"><input type="checkbox" name="selected_all_instances" value="all"></th>
			{% for c in admin_view.list_display %}
				<th>
					{% set name = admin_view.field_name(c) %}
					{% if admin_view.is_sortable(c)%}
						{% if sort == c %}
							<a href="{{ admin_view.sort_url(c if not sort_desc else None, True) }}">
							{{ name }}
							{% if sort_desc %}
								<i class="icon-chevron-up"></i>
							{% else %}
								<i class="icon-chevron-down"></i>
							{% endif %}
						</a>
						{% else %}
							<a href="{{ admin_view.sort_url(c) }}">{{ name }}</a>
						{% endif %}
					{% else %}
						{{ name }}
					{% endif %}
				</th>
			{% else %}
				<th>
					{{ name|capitalize }}
				</th>
			{% endfor %}
		</tr>
	</thead>
	{% for instance in data %}
		<tr>
			<td>
				{% set pk = admin_view.get_pk(instance) %}
				<input type="checkbox" name="_selected_action" value="{{ pk }}">
			</td>
			{% for c in admin_view.list_display %}
				{% if loop.first %}
					<td><a href="{{ url_for('.edit', pk=pk) }}">{{ admin_view.get_column(instance, c) }}</a></td>
				{% else %}
					{% with reference = admin_view.get_reference(admin_view.get_column(instance, c)) %}
						{% if reference %}
							<td><a href="{{ reference }}">{{ admin_view.get_column(instance, c) }}</a></td>
						{% else %}
							<td>{{ admin_view.get_column(instance, c) }}</td>
						{% endif %}
					{% endwith %}
				{% endif %}
			{% else %}
				<td><a href="{{ url_for('.edit', pk=pk) }}">{{ instance|string or 'None' }}</a></td>
			{% endfor %}
		</tr>
	{% endfor %}
</table>
<nav>
	<ul class="pagination">
		{% if total_pages > 1 %}
			{% set min = page - 3 %}
			{% set max = page + 3 + 1 %}
			{% if min < 0 %}
				{% set max = max-min %}
			{% endif %}
			{% if max >= total_pages %}
				{% set min = min - max + total_pages %}
			{% endif %}
			{% if min < 0 %}
				{% set min = 0 %}
			{% endif %}
			{% if max >= total_pages %}
				{% set max = total_pages %}
			{% endif %}
			{% if min > 0 %}
				<li><a href="{{ admin_view.page_url(0) }}" aria-label="First"><span aria-hidden="true">First</span></a></li>
			{% else %}
				<li class="disabled"><a href="#" aria-label="First"><span aria-hidden="true">First</span></a></li>
			{% endif %}
			{% if page > 0 %}
				<li><a href="{{ admin_view.page_url(page-1) }}" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
			{% else %}
				<li class="disabled"><a href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
			{% endif %}
			{% for p in range(min,max) %}
				{% if page == p %}
					<li class="active"><a href="#" aria-label="Current page"><span aria-hidden="true">{{ p + 1 }}</span></a></li>
				{% else %}
					<li><a href="{{ admin_view.page_url(p) }}" aria-label="Page {{ p + 1}}"><span aria-hidden="true">{{ p + 1 }}</span></a></li>
				{% endif %}
			{% endfor %}
			{% if page + 1 < total_pages %}
				<li><a href="{{ admin_view.page_url(page + 1) }}" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>
			{% else %}
				<li class="disabled"><a href="#" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>
			{% endif %}
			{% if max < total_pages %}
				<li><a href="{{ admin_view.page_url(total_pages - 1) }}" aria-label="Last"><span aria-hidden="true">Last</span></a></li>
			{% else %}
				<li class="disabled"><a href="#" aria-label="Last"><span aria-hidden="true">Last</span></a></li>
			{% endif %}
		{% endif %}
	</ul>
</nav>
{% endblock %}
